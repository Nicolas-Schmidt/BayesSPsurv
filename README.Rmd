---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# spatialSPsurv

<!-- badges: start -->
[![R build status](https://github.com/Nicolas-Schmidt/spatialSPsurv/workflows/R-CMD-check/badge.svg)](https://github.com/Nicolas-Schmidt/spatialSPsurv/actions)
[![Project Status: Active â€“ The project has reached a stable, usable
state and is being actively
developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![License:
MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
`r badger::badge_devel("Nicolas-Schmidt/BayesMFSurv", "blue")`
<!-- badges: end -->

Bayesian Spatial Split Population Survival Model




Manual [__here__](https://github.com/Nicolas-Schmidt/spatialSPsurv/blob/master/man/figures/manual_spatialSPsurv.pdf).



## Installation

``` r
source("https://install-github.me/Nicolas-Schmidt/spatialSPsurv")
```



```{r, echo = FALSE, warning=FALSE, message=FALSE}
#source('data-raw/fsps.r')
library(spduration)
```


### Functions

|argument   |`spatialSPsurv()` |`exchangeSPsurv()` |`pooledSPsurv()`        |
|-----------|------------------|------------------|------------------|
|`duration` |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`immune`   |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`Y0`       |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`LY`       |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`data`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`N`        |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`burn`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`thin`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`w`        |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`m`        |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`form`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`prop.var` |:heavy_check_mark:|:heavy_check_mark:|:x:               |
|`S`        |:heavy_check_mark:|:heavy_check_mark:|:x:               |
|`A`        |:heavy_check_mark:|:x:               |:x:               |











### Data
```{r, warning=FALSE}
library(spatialSPsurv)

walter <- spduration::add_duration(Walter_2015_JCR,"renewed_war", unitID = "id", tID = "year", freq = "year", ongoing = FALSE)
walter <- spatialSPsurv::spatial_SA(data = walter, var_ccode = "ccode", threshold = 800L)
```

### Example

#### `exchangeSPsurv`

```{r}

set.seed(782566)
tch <- 
    exchangeSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        S        = 'sp_id' ,
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "Weibull",
        prop.var = 1e-05
    )

str(tch)

```

#### `pooledSPsurv`

```{r}
set.seed(782566)

tch2 <- 
    pooledSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "Weibull"
    )

str(tch2)

```


#### `spatialSPsurv`

```{r}
set.seed(782566)

tch3 <- 
    spatialSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        S        = 'sp_id' ,
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "Weibull",
        prop.var = 1e-05,
        A        = walter[[2]]
    )

str(tch3)

```






## check form

```{r}

duration <- duration ~ fhcompor1 + lgdpl + comprehensive + victory + instabl + intensityln + ethfrac + unpko
immune   <- cured ~ fhcompor1 + lgdpl + victory
Y0       <- 't.0'
LY       <- 'lastyear'
S        <- 'sp_id' 
data     <- walter[[1]]
N        <- 100
burn     <- 10
thin     <- 10
w        <- c(1,1,1)
m        <- 10
prop.var <- 1e-05
A        <- walter[[2]]

## ~~~~~~~~~~~~~
## exchangeSPsurv
## ~~~~~~~~~~~~~

set.seed(782566)
str(exchangeSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, S = S, 
                  data = data, N = N, burn = burn, thin = thin, w = w, m = m, 
                  prop.var = prop.var, form = 'Weibull'))
set.seed(782566)
str(exchangeSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, S = S, 
                  data = data, N = N, burn = burn, thin = thin, w = w, m = m, 
                  prop.var = prop.var, form = 'exponential'))

set.seed(782566)
str(exchangeSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, S = S, 
                  data = data, N = N, burn = burn, thin = thin, w = w, m = m, 
                  prop.var = prop.var, form = 'loglog'))

## ~~~~~~~~~~~~~
## spatialSPsurv
## ~~~~~~~~~~~~~

set.seed(782566)
str(spatialSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, S = S, 
                  data = data, N = N, burn = burn, thin = thin, w = w, m = m, 
                  prop.var = prop.var, A = A, form = 'Weibull'))
set.seed(782566)
str(spatialSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, S = S, 
                  data = data, N = N, burn = burn, thin = thin, w = w, m = m, 
                  prop.var = prop.var, A = A, form = 'exponential'))

set.seed(782566)
str(spatialSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, S = S, 
                  data = data, N = N, burn = burn, thin = thin, w = w, m = m, 
                  prop.var = prop.var, A = A, form = 'loglog'))
## ~~~~~~~~~~~~~
## SPsurv
## ~~~~~~~~~~~~~

set.seed(782566)
str(pooledSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, data = data, 
           N = N, burn = burn, thin = thin, w = w, m = m, form = 'Weibull'))

set.seed(782566)
str(pooledSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, data = data, 
           N = N, burn = burn, thin = thin, w = w, m = m, form = 'exponential'))

set.seed(782566)
str(pooledSPsurv(duration = duration, immune = immune, Y0 = Y0, LY = LY, data = data, 
           N = N, burn = burn, thin = thin, w = w, m = m, form = 'loglog'))

```



---------------


### Internal check (omit)
```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
net_str_f <- function(package){
    init <- ls(pos = 1)
    package <- 'spatialSPsurv'
    suppressMessages(require(package, character.only = TRUE)) 
    source(here::here('R', 'utils.r')) 
    visible_fun_pack <- ls(search()[search() == paste0("package:", package)]) 
    all_fun_pack <- setdiff(ls(pos = 1), init)[-c(7, 21)]
    all   <- c(all_fun_pack, visible_fun_pack) 
    l1 <- purrr::map(all, function(x){pryr::fun_calls(body(x))})
    l2 <- purrr::map(l1, function(x) paste(paste0(all[all %in% x], "--"), collapse = ""))
    names(l2) <- all
    out <- 
    stack(l2) %>% tidyr::separate(col = 'values', into = paste("func", 1:6), sep = "--", remove = FALSE) %>% 
        .[, c(ncol(.), 2:(ncol(.)-1))]
    out[is.na(out)] <- ''
    out[,-7] %>% as_tibble() #%>% print(n = Inf)
    
    
}
```








```{r, echo = TRUE, , warning = FALSE}
## ---------------------
## LOCAL CHECK!
## ---------------------


#net_str_f('spatialSPsurv')

```


```{r, echo = FALSE, message = FALSE}
manual <- function(){
    old <- here::here()
    path <- here::here('man', 'figures')
    sink('noise.txt')
    devtools::build_manual(path = path)
    sink()
    setwd(path)
    invisible(file.rename(list.files(pattern="^spatialSPsurv"), 'manual_spatialSPsurv.pdf'))
    setwd(old)
    invisible(file.remove('noise.txt'))
}
manual()
```























