---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# spatialSPsurv

<!-- badges: start -->
[![R build status](https://github.com/Nicolas-Schmidt/spatialSPsurv/workflows/R-CMD-check/badge.svg)](https://github.com/Nicolas-Schmidt/spatialSPsurv/actions)
[![Project Status: Active â€“ The project has reached a stable, usable
state and is being actively
developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
[![License:
MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
`r badger::badge_devel("Nicolas-Schmidt/BayesMFSurv", "blue")`
<!-- badges: end -->

Bayesian Spatial Split Population Survival Model




Manual [__here__](https://github.com/Nicolas-Schmidt/spatialSPsurv/blob/master/man/figures/manual_spatialSPsurv.pdf).



## Installation

``` r
source("https://install-github.me/Nicolas-Schmidt/spatialSPsurv")
```



```{r, echo = FALSE, warning=FALSE, message=FALSE}
#source('data-raw/fsps.r')
library(spduration)
```


### Functions


| Function |Description |
| ----------------- | -------------------------------------------------------------- | 
|`exchangeSPsurv`|Markov Chain Monte Carlo (MCMC) to run Bayesian split population survival model with exchangeable frailties.|
|`pooledSPsurv` | Markov Chain Monte Carlo (MCMC) to run Bayesian split population survival model with no frailties|
|`spatialSPsurv`|Markov Chain Monte Carlo (MCMC) to run time-varying Bayesian split population survival model with spatial frailties.|
|`summary`|returns a summary of aexchangeSPsurv, pooledSPsurv or spatialSPsurv object via `coda::summary.mcmc`.|
|`spatial_SA`||
|`SPstats`|A function to calculate the deviance information criterion (DIC) and Log-likelihood for fitted model oupts of pooled, exchangeable, and spatial Split Population survival models for which a log-likelihood can be obtained, according to the formula `DIC = -2 * (L - P)`, where `L` is the log likelihood of the data given the posterior means of the parameter and `P` is the  estimate of the effective number of parameters in the model.|





|argument   |`spatialSPsurv()` |`exchangeSPsurv()` |`pooledSPsurv()`        |
|-----------|------------------|------------------|------------------|
|`duration` |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`immune`   |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`Y0`       |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`LY`       |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`data`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`N`        |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`burn`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`thin`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`w`        |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`m`        |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`form`     |:heavy_check_mark:|:heavy_check_mark:|:heavy_check_mark:|
|`prop.var` |:heavy_check_mark:|:heavy_check_mark:|:x:               |
|`S`        |:heavy_check_mark:|:heavy_check_mark:|:x:               |
|`A`        |:heavy_check_mark:|:x:               |:x:               |







### Example


#### Data
```{r, warning=FALSE}
library(spatialSPsurv)

walter <- spduration::add_duration(Walter_2015_JCR,"renewed_war", 
                                   unitID = "id", tID = "year", 
                                   freq = "year", ongoing = FALSE)
walter <- spatialSPsurv::spatial_SA(data = walter, var_ccode = "ccode", threshold = 800L)
```


#### `spatialSPsurv`

```{r, fig.width = 13, fig.height = 10}


## ~~~~~~~~~~~~~~~
## Weibull
## ~~~~~~~~~~~~~~~

set.seed(782566)

tch <- 
    spatialSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + 
                              instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        S        = 'sp_id' ,
        data     = walter[[1]],
        N        = 500,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "Weibull",
        prop.var = 1e-05,
        A        = walter[[2]]
    )

print(tch)

SPstats(tch)

plot(tch)

## ~~~~~~~~~~~~~~~
## loglog
## ~~~~~~~~~~~~~~~


set.seed(782566)

tchll <- 
    spatialSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + 
                              instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        S        = 'sp_id' ,
        data     = walter[[1]],
        N        = 500,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "loglog",
        prop.var = 1e-05,
        A        = walter[[2]]
    )

print(tchll)

SPstats(tchll)

plot(tchll)
```






#### `exchangeSPsurv`

```{r}
## ~~~~~~~~~~~~~~~
## Weibull
## ~~~~~~~~~~~~~~~

set.seed(782566)
tch1 <- 
    exchangeSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + 
                              instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        S        = 'sp_id' ,
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "Weibull",
        prop.var = 1e-05
    )

tch1

SPstats(tch1)


## ~~~~~~~~~~~~~~~
## loglog
## ~~~~~~~~~~~~~~~

set.seed(782566)
tchll1 <- 
    exchangeSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + 
                              instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        S        = 'sp_id' ,
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "loglog",
        prop.var = 1e-05
    )

tchll1


SPstats(tchll1)
```


#### `pooledSPsurv`

```{r}

## ~~~~~~~~~~~~~~~
## Weibull
## ~~~~~~~~~~~~~~~

set.seed(782566)

tch2 <- 
    pooledSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + 
                              instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "Weibull"
    )


tch2

SPstats(tch2)

## ~~~~~~~~~~~~~~~
## loglog
## ~~~~~~~~~~~~~~~

set.seed(782566)

tchll2 <- 
    pooledSPsurv(
        duration = duration ~ fhcompor1 + lgdpl + comprehensive + victory + 
                              instabl + intensityln + ethfrac + unpko,
        immune   = cured ~ fhcompor1 + lgdpl + victory,
        Y0       = 't.0',
        LY       = 'lastyear',
        data     = walter[[1]],
        N        = 100,
        burn     = 10,
        thin     = 10,
        w        = c(1,1,1),
        m        = 10,
        form     = "loglog"
    )

tchll2

SPstats(tchll2)
```












```{r echo=FALSE, message=FALSE}
manual <- function(){
    old <- here::here()
    path <- here::here('man', 'figures')
    sink('noise.txt')
    devtools::build_manual(path = path)
    sink()
    setwd(path)
    invisible(file.rename(list.files(pattern="^spatialSPsurv"), 'manual_spatialSPsurv.pdf'))
    setwd(old)
    invisible(file.remove('noise.txt'))
}
manual()
```























